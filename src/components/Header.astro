---
import { siteConfig } from "../config";
import GlobalSearch from "./GlobalSearch.astro";

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 backdrop-blur-sm"
  style="background-color: var(--bg-secondary-translucent)"
>
  <nav class="max-w-7xl mx-auto px-4 py-3 md:px-6 md:py-4">
    <ul class="flex items-center gap-3 md:gap-8 justify-center text-xs md:text-base flex-wrap">
      <li><a href="/cyberportfolio" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">Home</a></li>
      {hasExperience && (
        <li><a href="/cyberportfolio/ctf-writeups" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">CTFs</a></li>
      )}
      <li><a href="/cyberportfolio/blog" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">Blog</a></li>
      {hasProjects && (
        <li><a href="/cyberportfolio/#projects" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">Projects</a></li>
      )}
      <li><a href="/cyberportfolio/#about" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">About</a></li>
      {hasEducation && (
        <li><a href="/cyberportfolio/#education" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">Education</a></li>
      )}
      <li><a href="/cyberportfolio/comingsoon" class="font-medium text-[var(--text-primary)] hover:text-[var(--accent-color)] transition-colors">Others</a></li>
    </ul>
  </nav>
  <section class="max-w-4xl mx-auto px-4 py-1 md:py-3">
    <GlobalSearch />
  </section>
</header>

<script>
  const header = document.getElementById("header");
  const globalSearch = document.getElementById("globalSearch");
  let lastScrollY = 0;

  // Scroll behavior
  window.addEventListener("scroll", () => {
    const currentScrollY = window.scrollY;
    if (currentScrollY > lastScrollY && currentScrollY > 100) {
      if (document.activeElement !== globalSearch) {
        header.style.transform = "translateY(-100%)";
      }
    } else {
      header.style.transform = "translateY(0)";
    }
    lastScrollY = currentScrollY;
  });

  // Keep header visible when search is focused
  if (globalSearch) {
    globalSearch.addEventListener("focus", () => {
      header.style.transform = "translateY(0)";
    });
    globalSearch.addEventListener("blur", () => {
      if (window.scrollY > 100) {
        header.style.transform = "translateY(-100%)";
      }
    });
  }

  // Hide header when clicking outside
  document.addEventListener("click", (event) => {
    const target = event.target as HTMLElement;
    
    // Check if click is outside header
    if (header && !header.contains(target)) {
      // Only hide if scrolled past threshold
      if (window.scrollY > 100) {
        header.style.transform = "translateY(-100%)";
      }
    }
  });

  // Show header when clicking inside
  if (header) {
    header.addEventListener("click", (event) => {
      event.stopPropagation();
      header.style.transform = "translateY(0)";
    });
  }
</script>

<style>
  html { scroll-behavior: smooth; }
  #header { transform: translateY(0); }
</style>